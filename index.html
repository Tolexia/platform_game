<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    *{
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    body{
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100lvw;
        height: 100dvh;
        overflow: hidden;
    }
    canvas{
        border: 1px solid black;
    }
</style>
<body>
    <canvas id="canvas" ></canvas>
</body>
<script>
    var canvas = document.getElementById('canvas')
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    const ctx = canvas.getContext("2d");
    ctx.imageSmoothingEnabled = true;
    let raf;

    const ball = {
        x: 100,
        y: 100,
        vx: 5,
        vy: 2,
        radius: 5,
        color: "blue",
        draw() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, true);
          ctx.closePath();
          ctx.fillStyle = this.color;
          ctx.fill();
        },
    };

    class platform {
        constructor(x,y,width,height){
            this.x_start = x
            this.y_start = y
            this.width = width
            this.height = height
            this.x_end = x+width
            this.y_end = y+height
        }
        draw(){
            ctx.rect(this.x_start, this.y_start, this.width, this.height);
            ctx.fillStyle = "black"
            ctx.fill();
        }
    }
    const win_width = window.innerWidth
    const win_height = window.innerHeight
    const platforms = [
        new platform(0.2*win_width,0.9*win_height, 0.1*win_width, ball.radius * 5),
        new platform(0.4*win_width,0.8*win_height, 0.1*win_width, ball.radius * 5),
        new platform(0.6*win_width,0.7*win_height, 0.1*win_width, ball.radius * 5)
    ]
    
    setInterval(()=> {
          //console.log("plateform", platforms[0])
          //console.log("ball", ball)
    },2000)
    function draw() 
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ball.draw();
        let blockX = false
        let blockY = false
        for(const line of platforms)
        {
            line.draw()
            if(
                ball.x + ball.vx >= line.x_start - ball.radius && 
                ball.x + ball.vx <= line.x_end + ball.radius
            )
            {
                const onFloor = (ball.y + ball.vy  >= line.y_start - ball.radius) && (ball.y + ball.vy <= line.y_end)
                const underneathFloor = (ball.y + ball.vy <= line.y_end + ball.radius) && (ball.y + ball.vy  >= line.y_start) 
                //const underneathFloor = false 
                if(
                    onFloor || underneathFloor
                )
                {
                    /*if(underneathFloor)
                    {
                        console.log("ball.y", ball.y)
                        console.log("ball.vy", ball.vy)
                        console.log("y_start", y_start)
                        console.log("line.y_end", line.y_end)
                        console.log("ball.radius", ball.radius)
                    }*/
                    blockY = true
                    if(onFloor) jumpcount = 0
                }
            }
        }

        // Y
        if(blockY && !pressingUp)
        {
            ball.vy = 0
        }
        else if ( ball.y + ball.vy >= canvas.height - ball.radius  ) 
        {
            ball.vy = 0;
            jumpcount = 0;
        }
        else if (ball.y + ball.vy < ball.radius) {
            ball.vy = -ball.vy;
        }

        // X
        if (
            ball.x + ball.vx >= canvas.width - ball.radius ||
            ball.x + ball.vx <= ball.radius
        ) {
            ball.vx = 0;
        }

        ball.x += ball.vx;
        ball.y += ball.vy;

        ball.vy *= 0.99;
        ball.vy += 0.25;

        ball.vx *= 0.99
        
        raf = window.requestAnimationFrame(draw);
    }

    let jumpcount = 0

    let pressingUp = false
    let pressingDown = false
    let pressingLeft = false
    let pressingRight = false
    document.body.addEventListener("keydown", e => {
        console.log("jumpcount", jumpcount)
        if(e.key == "ArrowUp" && jumpcount < 2)
        {
            ball.vy = -10
            jumpcount++
        }
        if(e.key == "ArrowLeft")
        {
            pressingLeft = true 
            left()
        }
        if(e.key == "ArrowRight")
        {
            pressingRight = true 
            right()
        }
    })
    function up(){
        console.log(ball.vy)
        if(ball.vy > -10) ball.vy -= 1
        if(pressingUp == true)window.requestAnimationFrame(up)
    }
    function left(){
        if(ball.vx > -5) ball.vx -= 0.25
        if(pressingLeft == true)window.requestAnimationFrame(left)
    }
    function right(){
        if(ball.vx < 5) ball.vx += 0.5
        if(pressingRight == true)window.requestAnimationFrame(right)
    }
    document.body.addEventListener("keyup", e => {
        if(e.key == "ArrowLeft")
            pressingLeft = false 
        if(e.key == "ArrowRight")
            pressingRight = false 
    })
    
    ball.draw();
    draw()
</script>
</html>